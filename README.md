# نظام إدارة الموارد HCP ERP

نظام إدارة موارد شامل مصمم خصيصاً لشركة دلتا للدهانات الحديثة لإدارة توزيع وبيع الدهانات.

## 🚀 المميزات الرئيسية

### 📊 لوحة التحكم
- إحصائيات شاملة للمبيعات والطلبات والعملاء **بالجنيه المصري**
- رسوم بيانية تفاعلية لتتبع الأداء
- نشاط حديث ومؤشرات الأداء الرئيسية

### 🛒 إدارة المبيعات
- إنشاء فواتير مبيعات مع تفاصيل كاملة
- **تطبيق خصم العميل تلقائياً** عند اختيار العميل
- **إضافة ملاحظات للأصناف** في كل فاتورة
- أربع طرق دفع مختلفة:
  - تحصيل جزئي مقدم + باقي مع المندوب
  - دفع كامل مقدماً
  - تحصيل كامل عند التسليم
  - آجل كامل
- **إدارة العربون والمقدمات** (تم إصلاحها)
- تتبع حالة الطلبات

### 👥 إدارة العملاء
- قاعدة بيانات شاملة للعملاء
- تصنيف العملاء (فرد، شركة، مؤسسة)
- **نسبة خصم مخصصة لكل عميل** ⭐ جديد
- تتبع تاريخ المعاملات والأرصدة

### 📦 إدارة المخزون
- إدارة المنتجات بالفئات (إنشائية، خارجية، ديكورية)
- نظام الباتشات والأكواد
- تنبيهات المخزون المنخفض
- تتبع الكميات والأسعار

### 💰 إدارة الحسابات
- تسجيل المدفوعات من العملاء
- **كشف حساب مفصل لكل عميل** مع تفاصيل الحركات ⭐ جديد
- طرق دفع متعددة (نقدي، تحويل بنكي، فودافون كاش، شيك)
- ربط المدفوعات بالطلبات
- **عرض المدين والدائن والرصيد** لكل عميل

### 🔄 تتبع الطلبات ⭐ جديد
- **إدارة حالات الطلبات المتقدمة**:
  - تم تقديم الطلب
  - قيد التشغيل
  - مؤجل
  - تم الشحن
  - تم التسليم
  - ملغي
- تاريخ تحديثات الحالة مع الملاحظات
- تتبع المسؤول عن كل تحديث

### ↩️ مرتجع المبيعات ⭐ جديد
- **نظام شامل لإدارة مرتجعات المنتجات**
- ربط المرتجعات بالفواتير الأصلية
- أسباب متعددة للإرجاع (منتج معيب، لون غير مطابق، كمية زائدة، إلخ)
- طرق استرداد مختلفة (نقدي، خصم من الحساب، استبدال)
- تتبع حالة المرتجع (في الانتظار، موافق عليه، مرفوض، تم المعالجة)

### 👤 إدارة المستخدمين
- ثلاثة مستويات صلاحيات:
  - **Admin**: كامل الصلاحيات
  - **Supervisor**: عرض + تعديل + تقارير + إعدادات النظام
  - **Sales**: المبيعات + العملاء + مرتجع المبيعات
  - **User**: عرض + إضافة فقط
- **تسجيل خروج تلقائي قابل للتخصيص** (15-120 دقيقة أو بدون حد)

### ⚙️ إعدادات النظام ⭐ جديد
- **تغيير العملة الأساسية** (جنيه مصري، دولار، يورو، ريال سعودي)
- **التحكم في وقت الخروج التلقائي**
- إدارة بيانات الشركة (الاسم، العنوان، الهاتف، الرقم الضريبي)
- **إدارة حالات الطلبات المخصصة**
- إعدادات الإشعارات
- إعدادات اللغة

### 📈 التقارير
- تقارير المبيعات والمرتجعات
- تقارير نشاط العملاء
- تقارير المخزون والمنتجات
- **تقارير كشف حساب العملاء**
- تصدير PDF و Excel
- فلترة حسب التاريخ والعميل والمنتج

## 🆕 التحديثات الجديدة (الإصدار 2.0)

### ✅ الميزات المضافة:
1. **صفحة إعدادات النظام** - إدارة شاملة لجميع إعدادات النظام
2. **صفحة تتبع الطلبات** - متابعة حالة الطلبات مع تاريخ التحديثات
3. **صفحة مرتجع المبيعات** - نظام كامل لإدارة المرتجعات
4. **صفحة كشف حساب العملاء** - تفاصيل الحركات المالية لكل عميل
5. **خانة نسبة الخصم للعملاء** - في صفحة إدارة العملاء
6. **تطبيق خصم العميل تلقائياً** - في الفواتير عند اختيار العميل
7. **ملاحظات الأصناف** - إضافة ملاحظات لكل صنف في الفاتورة
8. **تغيير العملة للجنيه المصري** - في جميع أنحاء النظام

### 🔧 التحسينات:
- إصلاح محاذاة الصفحات وتحسين التخطيط العام
- تحسين مربعات التاريخ والفلتر (محاذاة النصوص)
- إصلاح مربع الإيداع/العربون في الفواتير
- تحسين تصميم النماذج والجداول
- إضافة أيقونات جديدة للقائمة الجانبية
- تحسين تجربة المستخدم العامة

## 🛠️ التقنيات المستخدمة

- **Frontend**: React 18 + Vite
- **Styling**: Tailwind CSS
- **State Management**: React Context API
- **Charts**: Chart.js + React Chart.js 2
- **Icons**: Heroicons
- **Notifications**: React Hot Toast
- **Routing**: React Router DOM
- **Database**: Local Storage (للنسخة التجريبية)
- **PDF Export**: jsPDF (قابل للإضافة)
- **Excel Export**: XLSX (قابل للإضافة)

## 📱 التصميم المتجاوب

النظام مصمم ليعمل بشكل مثالي على:
- 🖥️ أجهزة سطح المكتب
- 📱 الهواتف الذكية
- 📱 الأجهزة اللوحية

## 🔧 التثبيت والإعداد

### 1. متطلبات النظام
```bash
Node.js >= 16.0.0
npm >= 8.0.0
```

### 2. تثبيت المشروع
```bash
# استنساخ المشروع
git clone <repository-url>
cd HCP-ERP

# تثبيت التبعيات
npm install

# تشغيل المشروع
npm run dev
```

### 3. إعداد Firebase

#### إنشاء مشروع Firebase جديد:
1. اذهب إلى [Firebase Console](https://console.firebase.google.com/)
2. انقر على "Create a project"
3. أدخل اسم المشروع: `hcp-erp`
4. اختر الإعدادات المناسبة

#### تفعيل الخدمات المطلوبة:

**Authentication:**
1. اذهب إلى Authentication > Sign-in method
2. فعّل Email/Password
3. أضف المستخدمين الأوليين:
   - admin@hcp.com / admin123
   - supervisor@hcp.com / supervisor123
   - user@hcp.com / user123

**Firestore Database:**
1. اذهب إلى Firestore Database
2. انقر على "Create database"
3. اختر "Start in test mode" (مؤقتاً)
4. اختر المنطقة الأقرب

**Storage:**
1. اذهب إلى Storage
2. انقر على "Get started"
3. اختر الإعدادات الافتراضية

#### قواعد الأمان (Security Rules):

**Firestore Rules:**
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users collection - only authenticated users can read/write their own data
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
      allow read: if request.auth != null &&
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['Admin', 'Supervisor'];
    }

    // Products collection
    match /products/{productId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null &&
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['Admin', 'Supervisor', 'User'];
      allow delete: if request.auth != null &&
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['Admin', 'Supervisor'];
    }

    // Customers collection
    match /customers/{customerId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null &&
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['Admin', 'Supervisor', 'User'];
      allow delete: if request.auth != null &&
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['Admin', 'Supervisor'];
    }

    // Invoices collection
    match /invoices/{invoiceId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null &&
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['Admin', 'Supervisor', 'User'];
      allow delete: if request.auth != null &&
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['Admin', 'Supervisor'];
    }

    // Payments collection
    match /payments/{paymentId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null &&
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['Admin', 'Supervisor', 'User'];
      allow delete: if request.auth != null &&
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['Admin', 'Supervisor'];
    }
  }
}
```

**Storage Rules:**
```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      allow read, write: if request.auth != null;
    }
  }
}
```

#### تكوين المشروع:
1. اذهب إلى Project Settings > General
2. في قسم "Your apps"، انقر على "Web app"
3. أدخل اسم التطبيق: `HCP ERP`
4. انسخ Firebase config
5. استبدل المحتوى في `src/firebase/firebaseConfig.js`:

```javascript
const firebaseConfig = {
  apiKey: "your-api-key",
  authDomain: "your-project-id.firebaseapp.com",
  projectId: "your-project-id",
  storageBucket: "your-project-id.appspot.com",
  messagingSenderId: "your-sender-id",
  appId: "your-app-id"
};
```

### 4. إنشاء البيانات الأولية

بعد تشغيل المشروع، قم بإنشاء المستخدمين الأوليين في Firestore:

**مجموعة users:**
```javascript
// Document: admin-user-uid
{
  email: "admin@hcp.com",
  name: "مدير النظام",
  role: "Admin",
  createdAt: new Date(),
  createdBy: "system"
}

// Document: supervisor-user-uid
{
  email: "supervisor@hcp.com",
  name: "مشرف المبيعات",
  role: "Supervisor",
  createdAt: new Date(),
  createdBy: "system"
}

// Document: user-user-uid
{
  email: "user@hcp.com",
  name: "موظف المبيعات",
  role: "User",
  createdAt: new Date(),
  createdBy: "system"
}
```

## 🔐 بيانات الدخول التجريبية

| الدور | البريد الإلكتروني | كلمة المرور |
|-------|------------------|-------------|
| مدير | admin@hcp.com | admin123 |
| مشرف | supervisor@hcp.com | supervisor123 |
| مستخدم | user@hcp.com | user123 |

## 📁 هيكل المشروع

```
HCP-ERP/
├── public/
│   ├── index.html
│   └── vite.svg
├── src/
│   ├── components/
│   │   ├── Common/
│   │   │   ├── LoadingSpinner.jsx
│   │   │   ├── Modal.jsx
│   │   │   └── ProtectedRoute.jsx
│   │   └── Layout/
│   │       ├── Layout.jsx
│   │       ├── Header.jsx
│   │       └── Sidebar.jsx
│   ├── contexts/
│   │   ├── AuthContext.jsx
│   │   └── DataContext.jsx
│   ├── pages/
│   │   ├── Dashboard.jsx          # لوحة التحكم
│   │   ├── Sales.jsx              # المبيعات
│   │   ├── Customers.jsx          # العملاء (مع خصومات)
│   │   ├── Inventory.jsx          # المخزون
│   │   ├── Accounting.jsx         # الحسابات
│   │   ├── Users.jsx              # المستخدمين
│   │   ├── Reports.jsx            # التقارير
│   │   ├── Settings.jsx           # إعدادات النظام ⭐ جديد
│   │   ├── OrderTracking.jsx      # تتبع الطلبات ⭐ جديد
│   │   ├── SalesReturns.jsx       # مرتجع المبيعات ⭐ جديد
│   │   ├── CustomerAccounts.jsx   # كشف حساب العملاء ⭐ جديد
│   │   └── Login.jsx              # تسجيل الدخول
│   ├── App.jsx
│   ├── index.css
│   └── main.jsx
├── package.json
├── tailwind.config.js
├── postcss.config.js
└── vite.config.js
```

## 🚀 النشر

### GitHub:
```bash
# إضافة التغييرات
git add .

# إنشاء commit
git commit -m "feat: إضافة الميزات الجديدة والتحسينات"

# رفع للمستودع
git push origin master
```

### Vercel (الطريقة الموصى بها):
```bash
# تثبيت Vercel CLI
npm install -g vercel

# تسجيل الدخول
vercel login

# نشر المشروع
vercel --prod
```

### Firebase Hosting (بديل):
```bash
# تثبيت Firebase CLI
npm install -g firebase-tools

# تسجيل الدخول
firebase login

# تهيئة المشروع
firebase init hosting

# بناء المشروع
npm run build

# النشر
firebase deploy
```

## 💱 العملة المستخدمة

تم تحديث النظام ليستخدم **الجنيه المصري (ج.م)** كعملة أساسية في:
- لوحة التحكم والإحصائيات
- الفواتير والمبيعات
- كشف حساب العملاء
- جميع التقارير المالية

يمكن تغيير العملة من صفحة الإعدادات إلى:
- جنيه مصري (ج.م)
- دولار أمريكي ($)
- يورو (€)
- ريال سعودي (ر.س)

## 🔐 بيانات الدخول التجريبية

| الدور | البريد الإلكتروني | كلمة المرور | الصلاحيات |
|-------|------------------|-------------|-----------|
| مدير | admin@hcp.com | admin123 | كامل الصلاحيات |
| مشرف | supervisor@hcp.com | supervisor123 | عرض + تعديل + إعدادات |
| مبيعات | sales@hcp.com | sales123 | مبيعات + عملاء + مرتجعات |
| مستخدم | user@hcp.com | user123 | عرض + إضافة فقط |

## 📞 الدعم الفني

للحصول على الدعم الفني أو الإبلاغ عن مشاكل، يرجى التواصل مع فريق التطوير.

## 📄 الترخيص

هذا المشروع مملوك لشركة دلتا للدهانات الحديثة وهو للاستخدام الداخلي فقط.

---

**تم تطوير هذا النظام بواسطة فريق التطوير المتخصص**
**الإصدار:** 2.0.0
**آخر تحديث:** يناير 2024
**شركة دلتا للدهانات الحديثة**
